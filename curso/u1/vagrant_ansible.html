---
layout: presentacion
title: Vagrant y ansible. Una combinación explosiva
tema: solarized
---

<section>
	    <h1>Vagrant y ansible</h1>
	    <h3>Una combinación explosiva</h3>
	    <p>
	      <small><a href="http://albertomolina.wordpress.com">Alberto Molina
	      Coballes</a> / <a
	      href="http://twitter.com/alberto_molina">@alberto_molina</a> y <a
	      href="http://josedomingo.org">José Domingo Muñoz
	      Rodríguez</a> / <a
	      href="http://twitter.com/Pledin_JD">@Pledin_JD</a> </small>
	    </p>
	    <p><small>
		<a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="img/cc_by_sa.png"
		width="100px" border="0"/></a></small></p>
	  </section>

	  <section>
	    <section>
	    <h2>Cambio de paradigma</h2>
	    <p>Maneja tu infraestructura como tu software</p>
	    <ul>
	      <li> Utiliza software de control de versiones para las configuraciones y especificaciones</li>
	      <li>Todo debe ser legible</li>
	      <li>Automatiza</li>
	    </ul>
	    <p>DevOps...<strong>¿Esoqueloqué?</strong></p>
	    </section>
	  </section>
	  <section>
	    <section>
	      <h2>Vagrant. Introducción</h2>
	      
	      <ul>
		<li>Aplicación libre desarrollada en ruby para crear de forma sencilla un entorno de trabajo complejo</li>
		<li>El objetivo principal es aproximar los entornos de desarrollo y producción.</li>
		<li>Utiliza un entorno de máquinas virtuales (Virtualbox por defecto)</li>
		<li>Herramienta imprescindible para devops</li>
		<li>Potente uso didáctico</li>
		<li>Su lema:</li>
	      </ul>
	      <p><em>Development environments made easy: Create and configure lightweight, reproducible, and portable development environments.</em></p>

	    </section>
	    <section>
	      <h2>Vagrant. Instalación</h2>
	      <ul>
		<li>Instalar virtualbox</li>
		<li>Instalar vagrant (descargar de <a href="http://vagrantup.com">http://vagrantup.com)</a></li>
		<li>Notas:</li>
		<ul>
		  <li>Es posible utilizar otros proveedores, pero el mejor documentado es virtualbox.</li>
		  <li>Existen versiones de vagrant para GNU/Linux, Apple OS X y Ms windows</li>
		  <li>Vagrant tiene un fuerte desarrollo, por lo que hay bastantes diferencias entre versiones</li>
		  <li>En Debian Wheezy se incluye vagrant 1.0.3, mientras que la ultima versión disponible (Marzo 2014) es 1.5.1</li>
		  <li>Si empiezas ahora es recomendable utilizar vagrant ≥ 1.2.0 porque se ha modificado la API a la versión 2</li>
		</ul>
	      </ul>
	    </section>
	    <section>
	      <h2>Vagrant. Vagrantbox</h2>
	      
	      <ul>
		<li>Un box es una máquina virtual empaquetada.</li>
		<li>Vagrant proporciona algunos boxes oficiales, con idéntica clave ssh por lo que no son válidos para entornos en producción</li>
		<li>Listado incompleto y no oficial de boxes <a href="http://www.vagrantbox.es/">http://www.vagrantbox.es</a></li>
		<li>Siempre es posible hacerse un box a medida, aunque en la mayor de los casos no es necesario</li>
		<li>Para poder utilizar un box es necesario agregarlo al equipo:</li>
	      </ul>
	      <pre>	
vagrant box add {title} {url}
		</pre>
	       <ul>
		 <li>En el caso de sistemas UNIX, esto hace que se descargue y descomprima el <strong>box</strong> en  ~/.vagrant.d/boxes/</li>
		 </ul>
	     </section>
	    <section>
	      <h2>Vagrant. Vagrantfile</h2>
	      <ul>
		<li>Un fichero de nombre Vagrantfile describe una o varias instancias para crear un entorno vagrant en el directorio en el que se encuentre.</li>
		<li>Se pueden tener varios entornos vagrant independientes, ubicando ficheros Vagranfile en diferentes directorios.</li>
	        <li>Se puede crear un Vagrantfile mínimo con:</li>
	        <pre>

vagrant init
		</pre>
		</ul>
	    </section>
	    <section>
		<h3>Vagrant. Ejemplo de Vagrantfile</h3>
	      
	       <pre>	
	       <code data-trim>
# -*- mode: ruby -*-
# vi: set ft=ruby :
Vagrant.configure("2") do |config|
   config.vm.box = "precise32"
   config.vm.network :private_network, ip: "10.1.1.2"
end
	       </code>
	       </pre>
     
	      </section>
	   <section>
	     <h2>Vagrant. Utilización básica</h2>
	     <p>Todas las instrucciones se aplican sobre el Vagrantfile del directorio en el que se ejecuten</p>
	     <ul>
	       <li>Levantar el entorno</li>
	        <pre>	
vagrant up
	       </pre>
	       <li>Recargar el entorno (reinicia las máquinas y aplica los cambios):</li>
	        <pre>	
vagrant reload
	       </pre>
	     </ul>
	   </section>
	   <section>
	      <h2>Vagrant. Utilización básica (2)</h2>
	      <ul>
	       <li>Acceder a la instancia:</li>
	        <pre>	
vagrant ssh [nombre_instancia]
	      </pre>
	       <li>Suspender, apagar o destruir:</li>
   	       <pre>	
vagrant suspend
vagrant halt
vagrant destroy
	       </pre>
           </ul>
	   </section>

	  </section>
	  <section>
	    <section>
	      <h2>Ansible. Introducción</h2>
	       <ul>
		 <li>En ciencia ficción: Dispositivo que permite comunicarse a mayor velocidad que la luz</li>
		 <li>Ansible es una aplicación libre de orquestación escrita en python</li>
		 <li>La primera versión se desarrolló en febrero de 2012 (!)
	       </ul>
	    </section>
	    <section>
	      <h2>Ansible. Introducción (2)</h2>
	      <ul>
		 <li>Ventajas frente a otro software de automatizaci ́n (puppet o chef):</li>
		 <ul>
		   <li>Muy fácil instalación</li>
		   <li>Comunidad de desarrolladores muy activa</li>
		   <li>Muy pocas dependencias</li>
		   <li>Muy pequeño</li>
		   <li>Ideal para entornos pequeños y homogéneos</li>
		   <li>No es necesario configurar nada en los clientes</li>
		 </ul>
		 <li>Inconvenientes:</li>
		 <ul>
		   <li>Más complejo en entornos muy heterogéneos</li>
		   <li>Menos recetas desarrolladas previamente al ser muy nuevo</li>
		 </ul>

	       </ul>
	  </section>
	  <section>
	    <h2>Ansible. Instalación</h2>
	    <p>Para utilizar la última versión:</p>
	    <pre>
# apt-get install python-pip
# pip install ansible
	    </pre>
	    <p><strong>Voila!</strong></p>
	    
	  </section>
	  <section>
	    <h2>Ansible. Playbooks</h2>
	    <p>Las tareas a realizar por ansible se describen en formato yaml en ficheros denominados “playbooks”, que pueden incluir una o varias jugadas, por ejemplo:</p>
	    
	     <pre>	
	       <code data-trim>
---
- name: Apache installation
  hosts: all
  sudo: True
  tasks:
  - name: Set proper sources.list
    copy: >
      src=files/etc/apt/sources.list
      dest=/etc/apt/sources.list
      owner=root
      mode=644
  - name: Ensure apache is installed (after updating)
      apt: pkg=apache2 update_cache=yes
	       </code>
	     </pre>
	  </section>
	  </section>
	  <section>
	    <h2>Vagrant + Ansible</h2>
	    <p>Imagina que la siguiente situación para una determinada configuración de máquinas virtuales se pudiera hacer automáticamente:</p>
	    <ul>
	      <li>Levantar las máquinas virtuales</li>
	      <li>Configurar la red</li>
	      <li>Realizar las actualizaciones de software</li>
	      <li>Instalar los paquetes del software que se va a utilizar></li>
	      <li>Copiar los ficheros de configuraci ́n de plantillas previamente creadas</li>
	      <li>Levantar o parar los servicios que se determinen</li>
	      <li>Ejecutar cualquier tarea en cada una de las máquinas virtuales</li>
	      <li>Dejar el entorno completamente operativo</li>
	    </ul>
	    <p>No es ningún sueño: Eso es vagrant + ansible :-)</p>

	  </section>
</section>
