---
layout: presentacion
title: Instancias
tema: solarized
---
<section>
  <h1>OpenStack</h1>
  <h3>Trabajo con Instancias</h3>
  <p>
    <small><a href="http://albertomolina.wordpress.com">Alberto Molina
	Coballes</a> / <a
			  href="http://twitter.com/alberto_molina">@alberto_molina</a> y <a
											    href="http://josedomingo.org">José Domingo Muñoz
	Rodríguez</a> / <a
			   href="http://twitter.com/Pledin_JD">@Pledin_JD</a> </small>
  </p>
  <p><small>
      <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img src="../../img/cc_by_sa.png"
								    width="100px" border="0"/></a></small></p>
  <p><small>
      Theme
      by <a href="http://lab.hakim.se/reveal-js/#/">reveal.js</a>
    </small>
  </p>
</section>
<section>
	<ol>
		<li>Recordamos terminología de OpenStack</li>
		<li>Trabajamos con instancias, imágenes y snaphsots con Horizon</li>
		<li>Trabajamos con instancias, imágenes y snaphsots con Nova</li>
		<li>Estudiamos el funcionamiento interno de OpenStack cuando se trabaja con instancias</li>
	</ol>

</section>
<section>
<section>
			<h2>Conceptos previos (1)</h2>
	    <ul>
			<li>Imagen: Imagen de sistema preconfigurado que se utiliza como base para crear instancias. Dentro del cloud podemos encontrar diferentes imágenes para cada tipo de instacia que se quiera utilizar.</li>
			<li>Instancia: Clon de una imagen que se crea a demanda del usuario en uno de los  nodos del cloud.</li>
			<li>Un sabor (flavor) define para una instancia el número de CPUs virtuales, la RAM, si dispone o no de discos efímeros, etc.</li>
	    </ul>
	    </section>
	    <section>
			<h2>Conceptos previos (2)</h2>
	    <ul>
			<li>IP fija: Dirección IP con la que se crean las instancias y que se utiliza para comunicación interna.</li> 
			<li>IP flotante: Dirección IP que puede asociarse a diferentes instancias con el fin de acceder a ellas desde fuera.</li>
			<li>Grupo de seguridad: Reglas de cortafuegos (iptables) que controlan el acceso a las instancias mediante la dirección IP flotante.</li>
			<li>Par de claves ssh: Utilizadas para acceder por ssh a las instancias desde fuera del cloud</li>
	    </ul>
	    </section>
	<section>
	      <h2>Creación de una instancia</h2>
	      <ul>
		<li>Elegir la imagen que vamos a instanciar.</li>
		<li>Elegir el sabor que va a tener la instancia.</li>
		<li>Asignar el grupo de seguridad con el que va a trabajar la
		  instancia.</li>
		<li>Elegir la clave RSA que nos va a posibilitar el acceso a la
		  instancia.</li>
		<li>Elegir la red interna (o redes) a la que va a estar
		conectada la instancia.</li>
		<li>Asignar una IP flotante</li>
		</ul>
	    </section>
</section>
<section>
<section>
	<h2>Instancias con Horizon</h2>
</section>
<section>
	<ul>
		<li>Trabajamos con instancias creadas a partir de la imagen cirros (claves ssh, reglas de seguriad, ip flotantes,...)</li>
		<li>Subimos una imagen de Ubuntu y creamos una instancia.</li>
		<li>Modifcamos la configuración de la instancia Ubuntu y creamos un Snapshot.</li>
		<li>Creamos una nueva imagen a partir del snapshot y comprobamos que la nueva instancia tiene la misma configuración que la anterior.</li>
		<li>Redimensionamos una instancia.</li>
</section>
</section>

<section>
<section>
	<h2>Instancias con OpenStack CLI</h2>
</section>
<section>
	<h2>Imágenes</h2>
	<pre><code>
# Listar imágenes
$ glance image-list

# Detalles de una imagen
$ glance image-show cirros-0.3.1-x86_64-uec

# Crear una imagen
$ glance image-create --name ubuntu12.04 --disk-format=raw\
                      --container-format=bare --is-public=True\
                      --file=precise-server-cloudimg-amd64-disk1.img

# Borrar una imagen
$ glace delete ubuntu12.04
	</code></pre>
</section>
<section>
	<h2>Grupos de seguridad</h2>
	<pre><code>
# Listar grupos de seguridad
$ nova secgroup-list

# Crear un grupo de seguridad
$ nova secgroup-create cortafuegos

# Listar reglas de un grupo de seguridad
$ nova secgroup-list-rules default

# Añadir una regla a un grupo de seguridad
$ nova secgroup-add-rule default tcp 22 22 0.0.0.0/0
	</code></pre>
</section>
<section>
	<h2>Claves SSH</h2>
	<pre><code>
# Añadir un par de claves ssh
$ nova keypair-add mis_claves > mis_claves.pem
$ chmod 600 mis_claves.pem

# Listar las claves ssh
$ nova keypair-list
	</code></pre>
</section>
<section>
	<h2>Instancias (1)</h2>
	<pre><code>
#Listar de imágenes
$ nova image-list

# Listar sabores
$ nova flavor-list

# Listar las redes que tenemos definidas"
$ nova net-list

# Listar grupos de seguridad
$ nova secgroup-list

# Listar claves ssh
$ nova keypair-list
	</code></pre>
</section>
<section>
	<h2>Instancias (2)</h2>
	<pre><code>
# Creamos una instancia
$ nova boot --flavor FLAVOR_ID --image IMAGE_ID --key-name KEY_NAME \
            --security-groups SEC_GROUP --key-name KEY_NAME \
	    --nic net-id=NET_ID \
	    INSTANCE_NAME

# Ejemplo
$ nova boot --flavor 1 --image 9715a365-3b56-40b0-a30a-0ba030347cf5 \
            --security-groups default --key-name mis_claves 
            --nic net-id=d8d4d80e-923f-47fc-ac88-b9079328080b \
            instancia_prueba
	</code></pre>
</section>

<section>
	<h2>Instancias (3)</h2>
	<pre><code>
# Pausar instancia
$ nova pause INSTANCE_NAME 
$ nova unpause INSTANCE_NAME 

# Suspender/resumir
$ nova suspend INSTANCE_NAME
$ nova resume INSTANCE_NAME

# Reiniciar
$ nova reboot --hard SERVER

# Borrar
$ nova delete INSTANCE_NAME

# Acceder por consola
$ nova get-vnc-console INSTANCE_NAME xvpvnc
	</code></pre>
</section>
<section>
	<h2>Cambiar tamaño de la instancias</h2>
	<pre><code>
# Cambiar el flavor de una instancia
$ nova resize instancia_prueba 4 --poll

# Confirmar el cambio de tamaño
$ nova resize-confirm 84c6e57d-a6b1-44b6-81eb-fcb36afd31b5

# Revertir el cambio de tamaño
$ nova resize-revert 84c6e57d-a6b1-44b6-81eb-fcb36afd31b5
	</code></pre>
</section>
<section>
	<h2>IP flotantes</h2>
	<pre><code>
# Listar el pool de ip flotantes
$ nova floating-ip-pool-list

# Listar las ip flotantes que tienes reservada
$ nova floating-ip-list

# Reservar una nueva ip flotante
$ nova floating-ip-create

# Asociar una IP flotante a una instancia
$ nova floating-ip-associate instancia_prueba 172.24.4.227

# Desaciar una IP flotante de una instancia
$ nova floating-ip-disassociate instancia_prueba 172.24.4.227
	</code></pre>
</section>

<section>
	<h2>Snapshot</h2>
	<pre><code>
# Crear snapshot de una instancia
$ nova image-create --poll instancia_prueba snapshot_prueba

# Listar snapshots
$ nova image-list

# Para crear una nueva instancia se puede usar el snapshot

	</code></pre>
</section>
</section>



<section>
	<h2>Conceptos avanzados</h2>
</section>

